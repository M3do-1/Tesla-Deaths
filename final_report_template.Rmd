---
title: "CDS 101 – Final Project Report (Updated)"
author: "Group 4 / Ahmed Dirar, Ahmed Hassan, John Stevenson"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    css: "gmu-cds101.css"
    toc: true
    toc_depth: 3
    number_sections: true
  pdf_document:
    toc: true
---

# 1. Problem Definition

**Research question:** How many Tesla deaths were the result of a DUI from **2013 to 2022**?

**Goal:** Use the dataset to (1) label deaths as **DUI** vs **Other** using the accident description, (2) summarize trends by year, and (3) build a simple forecasting approach for what the next ~10 years *could* look like if historical patterns continued.

**Assumptions / constraints:**

- The dataset and the text descriptions are accurate.
- Our DUI labeling is **rule-based** (we mark a row as DUI if "DUI" appears in the description). That means we may miss cases that describe impaired driving without using the exact term “DUI”.

# 2. Data Acquisition & Description

- **Dataset:** *Tesla Accident Fatalities Analysis and Statistic (Updated 2023)* (Kaggle)
- **Unit of analysis:** one row per case (fatal accident)
- **Key columns used:** `Year`, `Description`
- **Approximate size:** ~296 rows and ~24 columns (may vary slightly depending on the version downloaded)

```{r setup-data, message=FALSE, warning=FALSE}
library(tidyverse)
library(readr)
library(modelr)
library(broom)

tesla_raw <- read_csv("Tesla_Deaths_Deaths_1_.csv", show_col_types = FALSE)

glimpse(tesla_raw)
```

# 3. Data Cleaning & Preprocessing

Main steps:

1. Keep only the columns we need for this report (`Year`, `Description`) plus any identifiers if needed.
2. Ensure `Year` is numeric.
3. Create a new label column (`Dscrip`) using string detection:
   - If `Description` contains "DUI" (case-insensitive) → label = `"DUI"`
   - Otherwise → label = `"other"`

```{r cleaning, message=FALSE, warning=FALSE}
tesla <- tesla_raw %>%
  mutate(
    Year = suppressWarnings(as.integer(Year)),
    Dscrip = if_else(
      str_detect(Description, regex("DUI", ignore_case = TRUE)),
      "DUI",
      "other"
    )
  ) %>%
  filter(!is.na(Year))

tesla %>% count(Dscrip)
```

We also compute year-level counts (how many deaths per year in each category).

```{r yearly-counts, message=FALSE, warning=FALSE}
year_counts <- tesla %>%
  count(Year, Dscrip, name = "Deaths") %>%
  tidyr::pivot_wider(names_from = Dscrip, values_from = Deaths, values_fill = 0) %>%
  mutate(
    Total = DUI + other,
    DUI_rate = if_else(Total > 0, DUI / Total, NA_real_)
  ) %>%
  arrange(Year)

year_counts
```

# 4. Exploratory Data Analysis

## Overall DUI share

```{r overall-share, message=FALSE, warning=FALSE}
overall_summary <- tesla %>%
  count(Dscrip) %>%
  mutate(percent = n / sum(n) * 100)

overall_summary
```

## Trend over time (2013–2022)

We plot the number of deaths by year for DUI vs Other.

```{r plot-trend, message=FALSE, warning=FALSE}
year_long <- tesla %>%
  count(Year, Dscrip, name = "Deaths")

ggplot(year_long, aes(x = Year, y = Deaths, color = Dscrip)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "Tesla deaths by year: DUI vs Other",
    x = "Year",
    y = "Number of deaths",
    color = "Category"
  )
```

# 5. Visualization Quality and Storytelling

- We used a **line chart** because it makes *year-to-year changes* easy to see and compare between DUI and other deaths.
- We kept the plot simple with clear labels and a legend so the story is readable at a glance.
- We used consistent scales and minimal visual clutter to keep the focus on the trend.

# 6. Modeling Approach

We used two lightweight models to forecast **2023–2032**:

1. **DUI probability model (binomial logistic regression):**  
   We model the *yearly DUI share* using year-level counts. This keeps the prediction in a valid 0–1 range.
2. **Total deaths model (linear regression):**  
   We model total deaths per year as a function of year.

Then we combine them:

- Predicted DUI deaths = `predicted_total * predicted_DUI_rate`
- Predicted Other deaths = `predicted_total * (1 - predicted_DUI_rate)`

This is simple, transparent, and fits the small dataset — but it is **not** a causal model and should be treated as a basic extrapolation.

# 7. Model Implementation & Evaluation

## Train/Test split (by year)

To keep evaluation simple and realistic, we train on earlier years and test on the most recent years.

```{r split-data, message=FALSE, warning=FALSE}
train <- year_counts %>% filter(Year <= 2020)
test  <- year_counts %>% filter(Year > 2020)

nrow(train); nrow(test)
```

## Fit models

```{r fit-models, message=FALSE, warning=FALSE}
# Binomial model for DUI share (uses counts)
dui_model <- glm(cbind(DUI, other) ~ Year, data = train, family = binomial())

# Linear model for yearly volume (total deaths)
vol_model <- lm(Total ~ Year, data = train)

summary(dui_model)
summary(vol_model)
```

## Evaluate on the test years

We compare our models to a simple baseline:

- Baseline DUI rate = average DUI rate in training years.
- Baseline volume = average yearly total in training years.

Metrics: **MAE** (Mean Absolute Error) for total deaths and DUI deaths on the test set.

```{r evaluate, message=FALSE, warning=FALSE}
# model predictions on test
test_pred <- test %>%
  mutate(
    pred_dui_rate = predict(dui_model, newdata = ., type = "response"),
    pred_total = pmax(0, predict(vol_model, newdata = .)),
    pred_dui = round(pred_total * pred_dui_rate),
    pred_other = round(pred_total * (1 - pred_dui_rate))
  )

# baseline predictions on test
baseline_dui_rate <- sum(train$DUI) / sum(train$Total)
baseline_total <- mean(train$Total)

test_pred <- test_pred %>%
  mutate(
    base_total = round(baseline_total),
    base_dui = round(Total * baseline_dui_rate)
  )

mae <- function(actual, predicted) mean(abs(actual - predicted), na.rm = TRUE)

eval_table <- tibble(
  Metric = c("MAE (Total deaths)", "MAE (DUI deaths)"),
  Baseline = c(
    mae(test_pred$Total, test_pred$base_total),
    mae(test_pred$DUI, test_pred$base_dui)
  ),
  Model = c(
    mae(test_pred$Total, test_pred$pred_total),
    mae(test_pred$DUI, test_pred$pred_dui)
  )
)

eval_table
```

## Forecast 2023–2032

```{r forecast, message=FALSE, warning=FALSE}
future_years <- tibble(Year = 2023:2032)

forecast <- future_years %>%
  mutate(
    pred_dui_rate = predict(dui_model, newdata = ., type = "response"),
    pred_total = pmax(0, predict(vol_model, newdata = .)),
    DUI_Deaths = round(pred_total * pred_dui_rate),
    Other_Deaths = round(pred_total * (1 - pred_dui_rate))
  )

forecast
```

### Forecast visualization

```{r forecast-plot, message=FALSE, warning=FALSE}
forecast_long <- forecast %>%
  select(Year, DUI_Deaths, Other_Deaths) %>%
  pivot_longer(cols = c(DUI_Deaths, Other_Deaths),
               names_to = "Category",
               values_to = "Deaths")

ggplot(forecast_long, aes(x = Year, y = Deaths, fill = Category)) +
  geom_col(position = "dodge") +
  labs(
    title = "Forecasted Tesla deaths (2023–2032): DUI vs Other",
    x = "Year",
    y = "Predicted deaths"
  )
```

# 8. Conclusions & Future Work

**What we found (2013–2022):**
- Using the text-based rule, we labeled each case as DUI vs Other and summarized the DUI share of deaths.
- The yearly trend plot shows how both categories change over time.

**Forecast (2023–2032):**
- We produced a simple forecast by combining a DUI-share model and a total-deaths model. This should be treated as an *informal projection* rather than a definitive prediction.

**Future improvements:**
- Improve labeling beyond the single keyword “DUI” (include terms like “intoxicated”, “drunk”, “BAC”, etc. and manually validate a sample).
- Include more predictors if available (location, vehicle model, Autopilot mentions, etc.).
- Compare multiple model types (Poisson regression for counts, time-series methods) and do cross-validation by year.

# 9. References

- R for Data Science (strings): https://r4ds.hadley.nz/strings.html  
- Kaggle dataset: Tesla Accident Fatalities Analysis and Statistics (Updated 2023):  
  https://www.kaggle.com/datasets/thedevastator/tesla-accident-fatalities-analysis-and-statistic

# Appendix (Optional)

```{r appendix-session-info, message=FALSE, warning=FALSE}
sessionInfo()
```
